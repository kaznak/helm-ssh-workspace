# SSH Workspace Helm Chart

SSH でアクセスできる作業用のシェル環境を構築する Helm Chart

## 仕様

### リソースに関して

- 設定情報に関しては ConfigMap, Secret を積極的に活用する
- PVC, ConfigMap, Secret は Helm Release を削除しても残るようにする
- 高セキュリティな環境を提供する
- ネットワークポリシーは外付けするため不要
- ssh サーバのベースイメージはまず ubuntu で作成する
- 合わせて導入するパッケージに関しては、差し当たっては ssh 環境を実現するために最低限必要なものとする。
- リソース制限に関しては values.yaml で設定できるようにし、デフォルトでは制限なしとする。

### sshd に関して

- 高セキュリティな設定を行う
- 設定情報やホストキーは secret に含めるようにする
- 認証方式は公開鍵のみ
- 暗号化方式は現在のデフォルトのものを使用し、 values.yaml で設定を変更できるようにする
- 設定ファイルはセキュリティを考慮したものをデフォルトとしてコンテナイメージに含める
- root 実行モードで、 k8s リソース側のセキュリティ設定を強化して高いセキュリティを実現する
- X11 転送はローカルホストからの接続のみ受け付けるよう制限する
  - ユーザは sshd の転送オプションを使用して利用する想定

### ログインユーザに関して

- 1 デプロイあたり 1 ユーザ専用
- デプロイ時に環境変数でログインを許可するユーザをuid/gidともに指定できる
- ユーザの設定に基づき sshd の AllowUsers の設定が反映される
- ユーザの設定に基づき、ユーザが存在しなければ作成される
- ユーザのホームディレクトリを永続化するオプションを提供する
  - 同ボリュームのパラメータに関しては values.yaml で設定できるようにする
  - サイズはデフォルトで 10GiB とする
- ユーザのSSH公開鍵はホームディレクトリに含めるほか、 configmap や secret でも提供できるようにする。
- sudo で root になれるかどうかはオプションで、デフォルトでは off
